<html lang="en">
    <head>

    </head>
    <body>
        <div>
            <h1>Current state</h1>
            <p id="state_active">Active: {{ current_state["active"] }}</p>
            <p id="state_triggered">Triggered: {{ current_state["triggered"] }}</p>
            <button id="btn_enabledisable">Enable</button>
        </div>
        <div>

        </div>

        <script type="text/javascript">
            window.addEventListener("load", () => {

                const state_active = document.getElementById("state_active");
                const state_triggered = document.getElementById("state_triggered");
                const btn_enabledisable = document.getElementById("btn_enabledisable");

                var state = {"active": false, "triggered": false};

                function update_btn_text()
                {
                    btn_enabledisable.textContent = state["active"] ? "Disable" : "Enable";
                }

                btn_enabledisable.addEventListener('click', async function enabledisable()
                {
                    const action = state["active"] ? 'disable' : 'enable';

                    (await fetch('/state', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({'action':action})
                    })).text().then(() => {});
                });

                update_btn_text();

                // Periodically update the device status
                setInterval(async () => {
                    (await fetch('/state', {method:'GET'})).json().then(data => {
                        console.log(data);
                        state = data;
                        state_active.textContent = "Active: " + data["active"];
                        state_triggered.textContent = "Triggered: " + data["triggered"];
                        update_btn_text();
                    });
                }, 1000);

            });
        </script>

    </body>
</html>
